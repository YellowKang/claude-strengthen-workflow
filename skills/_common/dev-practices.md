# 开发实践基线

所有改动默认遵守以下实践，各 skill 共享。

## 影响分析（改之前）

- 改动前先搜索调用方（grep 函数名/接口名/组件名），确认影响范围
- 改公共模块（utils/common/shared）时，列出所有依赖方
- 改接口签名（参数/返回值/路由）时，确认上下游是否适配
- 改数据库字段时，确认 ORM 映射、API 响应、前端绑定是否联动

## 现有功能摸底（做之前）

- 新功能开发前，先查是否有类似实现可复用，避免重复造轮子
- 检查现有接口/组件能否扩展满足需求，优先扩展而非新建
- 了解当前模块的设计意图和边界，不破坏已有架构假设

## 重构模式（改的时候）

- 提取函数/方法：先写测试覆盖原逻辑 → 提取 → 跑测试确认行为不变
- 改函数签名：新增参数给默认值 → 逐个调用方迁移 → 确认零旧调用后删默认值
- 移动代码到新模块：原位置留转发（re-export/wrapper）→ 迁移调用方 → 删转发
- 内联/合并：确认只有一个调用方或逻辑重复 → 内联 → 删原函数
- 重构原则：每步可编译可运行，不做"大爆炸"重构；重构和功能变更不混在同一个 commit

## 调试排查（出问题时）

- 复现优先：先稳定复现问题（明确输入/环境/步骤），不可复现的先加日志观察
- 二分定位：git bisect 或注释法缩小范围，不从头到尾读代码猜
- 日志分析：按 trace_id 串联请求链路，关注时间线（哪步慢/哪步报错）
- 最小化验证：构造最小复现用例（最少代码/最少数据），排除无关因素
- 修复后回归：写复现测试 → 修复 → 测试变绿 → 跑相关模块测试确认无副作用

## 联动清理（删之后）

- 删接口/函数/组件时，同步清理：调用方、测试用例、路由注册、i18n key、文档引用
- 删配置项时，同步清理：环境配置文件、默认值定义、文档说明
- 用 IDE/grep 确认零引用后再删，不留死代码

## 废弃策略

- 内部代码（不对外暴露）：确认无引用后直接删除，不留注释标记
- 对外 API/SDK：先标记 deprecated + 标注移除版本，下个大版本删除
- 数据库字段：先停止写入 → 确认无读取 → 迁移删除，不跳步

## 回归意识（改之后）

- 改业务逻辑后，跑相关模块测试
- 改公共模块后，跑全量测试
- 改接口后，确认前后端联调正常
