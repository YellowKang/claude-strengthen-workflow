---
name: error-handling
description: 统一错误码体系、前后端错误传递链路、用户友好错误展示
version: "1.0"
---

> 通用检查项见 ~/.claude/skills/_common/output-format.md
> 开发实践基线见 ~/.claude/skills/_common/dev-practices.md
> 输出格式遵循 CLAUDE.md

## 输入

- 涉及的接口或功能模块描述
- 现有错误处理代码（如有）
- 错误场景描述（用户操作 → 期望反馈）

## 职责（必须做）

### 错误码体系

- [ ] 错误码结构：`模块码(2位) + 错误类型(1位) + 序号(2位)`，如 `10001`；0 表示成功
- [ ] 错误类型分级：1=参数错误、2=业务规则违反、3=资源不存在、4=权限不足、5=系统内部错误、6=外部依赖错误
- [ ] 每个错误码对应：机器可读 code + 开发可读 message + 用户可读提示（三层分离）
- [ ] 错误码集中定义（常量文件/枚举），不在业务代码里散落魔法数字
- [ ] 新模块注册错误码段，避免冲突；维护错误码文档（code → 含义 → 处理建议）

### 后端错误处理

- [ ] 统一错误响应格式：`{ code: number, message: string, data: null }`，HTTP 状态码语义正确（400/401/403/404/500）
- [ ] 业务异常（可预期）vs 系统异常（不可预期）分离：业务异常返回具体 code + 用户可读 message，系统异常返回通用提示 + 记录详细日志
- [ ] 错误上下文链：底层 wrap 原始错误 → 中间层追加业务上下文 → 顶层统一捕获转换为响应
- [ ] 敏感信息不外泄：堆栈、SQL、内部路径、第三方错误详情不返回给前端，只写日志
- [ ] 第三方/上游错误转译：外部 API 错误映射为内部错误码，不透传原始错误给用户

### 前端错误处理

- [ ] 请求拦截器统一处理：401 → 跳登录，403 → 提示无权限，500 → 通用错误提示，网络错误 → 提示检查网络
- [ ] 业务错误（code ≠ 0）由组件按场景处理：表单提交 → 字段级错误定位，操作失败 → toast + 重试建议
- [ ] 错误提示用户友好：说明"发生了什么" + "可以怎么做"，不展示 code/堆栈/英文技术信息
- [ ] 前端异常兜底：全局 `errorHandler`（Vue）/ `ErrorBoundary`（React）捕获未处理异常，展示降级 UI
- [ ] 网络超时/断网场景：显示明确提示 + 自动重试或手动重试入口

### 错误日志与可追踪

- [ ] 每个请求携带 trace_id（后端生成，响应头返回），前端错误上报时附带 trace_id
- [ ] 错误日志必须包含：trace_id、错误码、错误消息、请求路径、用户标识、时间戳
- [ ] 关键操作失败记录完整上下文（入参摘要 + 错误链），便于复现

## 边界（不做什么）

- 不涉及具体语言的异常语法（try-catch/panic-recover → 见 go/java-conventions）
- 不涉及监控告警规则和平台配置
- 不涉及日志框架选型和配置
- 不涉及前端 UI 组件实现细节（→ 见 frontend-conventions + ui-ue-guidelines）

## 输出

输出格式遵循 CLAUDE.md，通用检查项见 _common/output-format.md。
